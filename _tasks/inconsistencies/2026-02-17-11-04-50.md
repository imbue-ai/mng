# Inconsistencies identified on 2026-02-17-11-04-50

## 1. claude_web_view app uses plain BaseModel instead of FrozenModel throughout

Description: The `apps/claude_web_view/imbue/claude_web_view/models.py` file defines 9 data classes (TextBlock, ToolUseBlock, ToolResultBlock, ParsedMessage, SessionMetadata, SSEInitEvent, SSEMessageEvent, SSECompleteEvent, SSEErrorEvent) all inheriting from `pydantic.BaseModel` instead of `FrozenModel`. Additionally, `apps/claude_web_view/imbue/claude_web_view/server.py:21` defines `SendMessageRequest(BaseModel)`. The style guide (lines 829-845) requires all data classes to inherit from `FrozenModel`, and stateful classes from `MutableModel` via an interface. The `_ListIterationParams` class at `libs/mngr/imbue/mngr/cli/list.py:551` also uses plain `BaseModel`.

Recommendation: Convert all data model classes in `models.py` to use `FrozenModel` from `imbue.imbue_common.frozen_model`. Convert `_ListIterationParams` likewise. Use `Field(description=...)` for all fields per the style guide.

Decision: Accept

## 2. claude_web_view app uses relative imports instead of absolute imports

Description: Every module in `apps/claude_web_view/imbue/claude_web_view/` uses relative imports (e.g., `from .models import ...`, `from .parser import ...`, `from .watcher import ...`, `from .server import ...`). There are 11 relative import lines across 4 files: `parser.py:8-14`, `server.py:17-18`, `watcher.py:10`, `cli.py:12`. The style guide (line 1215-1218) explicitly states "Always use absolute imports. Never use relative imports." The existing ratchet test `test_prevent_relative_imports` enforces this for the mngr library but does not cover apps.

Recommendation: Change all relative imports to absolute imports (e.g., `from imbue.claude_web_view.models import ...`). Consider extending the relative import ratchet test to cover all packages, not just the mngr library.

Decision: Accept

## 3. claude_web_view CLI uses argparse instead of click

Description: `apps/claude_web_view/imbue/claude_web_view/cli.py` uses `argparse` (line 3: `import argparse`, lines 40-79: full argparse-based argument parsing) instead of `click`. The style guide (lines 1448-1451) explicitly states "Always use `click` to create commandline interfaces" and "Always parse the command line arguments into a structured, fully typed, frozen object."

Recommendation: Rewrite the CLI using `click` decorators and parse arguments into a `FrozenModel` options object, following the pattern used throughout the mngr library's `cli/` directory.

Decision: Accept

## 4. NamedTuple usage in core library instead of FrozenModel

Description: Two locations use `NamedTuple` from `typing`, which violates the style guide (line 1859: "Never use dataclasses or named tuples"):
- `libs/mngr/imbue/mngr/utils/logging.py:232-236`: `BufferedMessage(NamedTuple)` with fields `formatted_message: str` and `is_stderr: bool`.
- `libs/mngr/imbue/mngr/conftest.py:537-542`: `ModalSubprocessTestEnv(NamedTuple)` with fields `env`, `prefix`, `host_dir`.

Recommendation: Convert `BufferedMessage` to a `FrozenModel`. The `ModalSubprocessTestEnv` in conftest.py is test infrastructure and lower priority, but should also be converted to `FrozenModel` for consistency.

Decision: Accept

## 5. claude_web_view app uses print() instead of loguru for logging

Description: 12 instances of `print()` are used for output and error reporting across the claude_web_view app instead of using `loguru`:
- `apps/claude_web_view/imbue/claude_web_view/parser.py:63`: Warning message on parse failure.
- `apps/claude_web_view/imbue/claude_web_view/server.py:97-107`: 7 print statements in the `send_message` endpoint.
- `apps/claude_web_view/imbue/claude_web_view/cli.py:86-87,95,107`: 4 print statements for errors and startup messages.
The style guide (lines 1268-1280) requires using `loguru` for all logging.

Recommendation: Replace all `print()` calls with appropriate `loguru` logger calls (`logger.info` for user-facing CLI messages, `logger.warning`/`logger.error` for error conditions, `logger.debug` for library code).

Decision: Accept

## 6. claude_web_view uses module-level docstrings

Description: Every Python file in `apps/claude_web_view/imbue/claude_web_view/` has a module-level docstring, violating the style guide (line 579: "Never create docstrings for modules"):
- `models.py:1`: `"""Pydantic models for Claude Code transcript parsing."""`
- `server.py:1`: `"""FastAPI server serving frontend + SSE endpoint."""`
- `parser.py:1`: `"""JSONL transcript parser for Claude Code sessions."""`
- `watcher.py:1`: `"""File watcher for transcript updates."""`
- `cli.py:1`: `"""CLI entry point for claude-web-view."""`
- `__init__.py:1`: `"""claude_web_view - Web viewer for Claude Code sessions."""`
- `__main__.py:1`: `"""Entry point for ..."""`
Additionally, `apps/sculptor_web/imbue/sculptor_web/main.py:1` has `"""Web interface for managing AI coding agents via mngr."""`

Recommendation: Remove all module-level docstrings. The `__init__.py` docstring is also a violation of the "no code in __init__.py" rule.

Decision: Accept

## 7. MessageRole enum uses (str, Enum) instead of UpperCaseStrEnum

Description: `apps/claude_web_view/imbue/claude_web_view/models.py:11-16` defines `MessageRole(str, Enum)` with lowercase string values (`"user"`, `"assistant"`, `"system"`) instead of using `UpperCaseStrEnum` with `auto()`. The style guide (lines 203-233) requires all enums to inherit from `UpperCaseStrEnum`, use UPPER_CASE keys, and `auto()` values.

Recommendation: Change to inherit from `UpperCaseStrEnum` and use `auto()` for values. If the lowercase string values are required for serialization compatibility, use a custom serialization method.

Decision: Accept

## 8. Plain Python classes with mutable state not following the interface/implementation pattern

Description: Several classes use plain Python class definitions with `__init__` and mutable state instead of following the `MutableModel`/interface pattern:
- `apps/claude_web_view/imbue/claude_web_view/watcher.py:13-75`: `TranscriptWatcher` is a plain class with mutable state (`_subscribers`, `_watch_task`, `_stop_event`).
- `apps/claude_web_view/imbue/claude_web_view/parser.py:17+`: `TranscriptParser` is a plain class with mutable state.
- `libs/mngr/imbue/mngr/providers/modal/log_utils.py:30-58`: `_MultiWriter` is a plain class.
- `libs/mngr/imbue/mngr/providers/modal/log_utils.py:68-108`: `ModalLoguruWriter` is a plain class.
The style guide (lines 829-845) defines only three types of classes: FrozenModel for data, interfaces (ABC + MutableModel), and implementations inheriting from interfaces.

Recommendation: For claude_web_view classes, redesign using the interface/implementation pattern. For the Modal log_utils classes, these are internal adapters for Modal's SDK and may justify being kept as plain classes, but ideally should still inherit from `MutableModel`.

Decision: Accept

## 9. __init__.py file contains code in claude_web_view

Description: `apps/claude_web_view/imbue/claude_web_view/__init__.py` contains a module docstring (`"""claude_web_view - Web viewer for Claude Code sessions."""`). The style guide (line 1236) states "Never put any code in an `__init__.py` file" with the only exception being `hookimpl = pluggy.HookimplMarker(...)` at the root of a library.

Recommendation: Remove the docstring from `__init__.py`, leaving it completely blank.

Decision: Accept

## 10. Missing return type annotations on several functions

Description: Several functions are missing return type annotations, violating the style guide (line 693-695: "Always include complete type hints"):
- `libs/mngr/imbue/mngr/providers/modal/log_utils.py:142`: `def step_progress(text: str = ""):` -- missing return type.
- `libs/mngr/imbue/mngr/providers/modal/log_utils.py:145`: `def make_live(self, renderable):` -- missing return type and parameter type.
- `libs/mngr/imbue/mngr/providers/modal/log_utils.py:150`: `def print(self, renderable) -> None:` -- missing parameter type for `renderable`.
- `libs/mngr/imbue/mngr/providers/modal/log_utils.py:154`: `async def put_log_content(self, log):` -- missing return type and parameter type.
- `libs/mngr/imbue/mngr/providers/modal/log_utils.py:119`: `def Pointless():` -- missing return type annotation.

Recommendation: Add complete type annotations to all functions and parameters. These are methods overriding Modal SDK's `OutputManager`, so the types may need to match Modal's API.

Decision: Accept
